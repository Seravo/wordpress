# Docker Compose for Seravo WordPress project template
#
# To start, simply run:
#   SITE=example docker-compose up
#
# Clean up:
#   docker-compose down -v --remove-orphans
#   rm -rf .vagrant
#
version: '3'

services:
  wordpress:
    container_name: ${SITE:-wordpress}
    hostname: ${SITE:-wordpress}
    domainname: ${SITE:-wordpress}
    image: seravo/wordpress:development
    volumes:
      - wp-data:/data
      - .:/data/wordpress
    entrypoint: /sbin/swd_init
    labels:
      - traefik.enable=true
      - traefik.http.routers.wp.rule=Host(`wp.localhost`)
      - traefik.http.routers.wp.entrypoints=web
      - traefik.http.routers.wps.rule=Host(`wp.localhost`)
      - traefik.http.routers.wps.entrypoints=websecure
      - traefik.http.routers.wps.tls=true
      - traefik.tcp.routers.wph.rule=HostSNI(`*`)
      - traefik.tcp.routers.wph.entrypoints=ssh
      - traefik.tcp.routers.wph.service=wphs
      - traefik.tcp.services.wphs.loadbalancer.server.port=22
      - traefik.http.services.wp.loadbalancer.server.port=80
    environment:
      - WP_USER_UID=${WP_USER_UID}
      - DEBUG=${DEBUG}

  traefik:
    container_name: traefik
    image: traefik:v2.3
    command:
      - --log.level=debug
      - --api.insecure=true
      - --providers.docker
      - --entrypoints.ssh.address=:22
      - --entrypoints.web.address=:80
      - --entrypoints.websecure.address=:443
      - --serverstransport.insecureskipverify=true
    ports:
      - 22:22
      - 80:80
      - 443:443
      - 8080:8080
      - 8989:8989
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

volumes:
  wp-data:
